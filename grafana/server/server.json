{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": { "type": "grafana", "uid": "-- Grafana --" },
        "enable": true,
        "hide": false,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "description": "Temporal Server dashboard for monitoring workflow progress, service health, and persistence performance.",
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 1,
  "id": null,
  "iteration": 1,
  "links": [],
  "liveNow": false,
  "panels": [
    {
      "id": 1,
      "type": "text",
      "title": "Dashboard Guide",
      "gridPos": { "h": 5, "w": 24, "x": 0, "y": 0 },
      "options": {
        "mode": "markdown",
        "content": "## Temporal Server Health Dashboard\n\nThis dashboard answers three key questions:\n\n1. **Are workflows making progress?** → Check Service Requests and Workflow Outcomes\n2. **Is the History service keeping up?** → Check Task Processing and Shard Health\n3. **Is persistence a bottleneck?** → Check Persistence Latency and DSQL Metrics\n\n**Troubleshooting flow**: If service requests look normal but workflows aren't completing, check History tasks → then Persistence."
      }
    },

    { "id": 2, "type": "row", "title": "Service Health Overview", "gridPos": { "h": 1, "w": 24, "x": 0, "y": 5 }, "collapsed": false, "panels": [] },

    {
      "id": 3,
      "type": "stat",
      "title": "Service Request Rate",
      "description": "Total gRPC requests per second across all services. A sudden drop may indicate connectivity issues or service crashes.",
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "gridPos": { "h": 4, "w": 6, "x": 0, "y": 6 },
      "fieldConfig": { "defaults": { "unit": "reqps", "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] } }, "overrides": [] },
      "options": { "reduceOptions": { "calcs": ["lastNotNull"] }, "colorMode": "value", "graphMode": "area" },
      "targets": [{ "refId": "A", "expr": "sum(rate(service_requests_total{namespace=~\"$namespace\"}[1m]))", "legendFormat": "requests/sec" }]
    },
    {
      "id": 4,
      "type": "stat",
      "title": "Service Error Rate",
      "description": "Errors per second. Non-zero values warrant investigation. Check service_error_with_type for error breakdown.",
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "gridPos": { "h": 4, "w": 6, "x": 6, "y": 6 },
      "fieldConfig": { "defaults": { "unit": "reqps", "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "yellow", "value": 0.1 }, { "color": "red", "value": 1 }] } }, "overrides": [] },
      "options": { "reduceOptions": { "calcs": ["lastNotNull"] }, "colorMode": "value", "graphMode": "area" },
      "targets": [{ "refId": "A", "expr": "sum(rate(service_error_with_type_total{namespace=~\"$namespace\"}[1m]))", "legendFormat": "errors/sec" }]
    },
    {
      "id": 5,
      "type": "stat",
      "title": "Workflow Success Rate",
      "description": "Workflows completing successfully per minute. This is your primary indicator of system health.",
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "gridPos": { "h": 4, "w": 6, "x": 12, "y": 6 },
      "fieldConfig": { "defaults": { "unit": "short", "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] } }, "overrides": [] },
      "options": { "reduceOptions": { "calcs": ["lastNotNull"] }, "colorMode": "value", "graphMode": "area" },
      "targets": [{ "refId": "A", "expr": "sum(rate(workflow_success_total{namespace=~\"$namespace\"}[1m])) * 60", "legendFormat": "success/min" }]
    },
    {
      "id": 6,
      "type": "stat",
      "title": "Workflow Failures",
      "description": "Workflows failing per minute. Includes failures, timeouts, and terminations. Non-zero may indicate application issues.",
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "gridPos": { "h": 4, "w": 6, "x": 18, "y": 6 },
      "fieldConfig": { "defaults": { "unit": "short", "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "yellow", "value": 1 }, { "color": "red", "value": 10 }] } }, "overrides": [] },
      "options": { "reduceOptions": { "calcs": ["lastNotNull"] }, "colorMode": "value", "graphMode": "area" },
      "targets": [{ "refId": "A", "expr": "sum(rate(workflow_failed_total{namespace=~\"$namespace\"}[1m]) + rate(workflow_timeout_total{namespace=~\"$namespace\"}[1m]) + rate(workflow_terminate_total{namespace=~\"$namespace\"}[1m])) * 60", "legendFormat": "failures/min" }]
    },

    {
      "id": 7,
      "type": "timeseries",
      "title": "Service Requests by Operation",
      "description": "Request rate broken down by operation. Helps identify which operations are driving load.",
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 10 },
      "fieldConfig": { "defaults": { "unit": "reqps", "custom": { "showPoints": "never" } }, "overrides": [] },
      "options": { "legend": { "displayMode": "table", "placement": "right", "calcs": ["mean", "max"] } },
      "targets": [{ "refId": "A", "expr": "topk(10, sum by (operation) (rate(service_requests_total{namespace=~\"$namespace\"}[1m])))", "legendFormat": "{{operation}}" }]
    },
    {
      "id": 8,
      "type": "timeseries",
      "title": "Service Latency p95 by Service",
      "description": "95th percentile latency for each Temporal service.",
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 10 },
      "fieldConfig": { "defaults": { "unit": "s", "custom": { "showPoints": "never" } }, "overrides": [] },
      "options": { "legend": { "displayMode": "table", "placement": "right", "calcs": ["mean", "max"] } },
      "targets": [{ "refId": "A", "expr": "histogram_quantile(0.95, sum by (service_name, le) (rate(service_latency_bucket{namespace=~\"$namespace\"}[5m])))", "legendFormat": "{{service_name}}" }]
    },

    { "id": 10, "type": "row", "title": "History Service & Task Processing", "gridPos": { "h": 1, "w": 24, "x": 0, "y": 18 }, "collapsed": false, "panels": [] },

    {
      "id": 11,
      "type": "timeseries",
      "title": "History Task Processing Rate",
      "description": "Rate of internal history tasks being processed.",
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 19 },
      "fieldConfig": { "defaults": { "unit": "ops", "custom": { "showPoints": "never" } }, "overrides": [] },
      "options": { "legend": { "displayMode": "list", "placement": "bottom" } },
      "targets": [
        { "refId": "A", "expr": "sum(rate(task_requests_total{service_name=\"history\"}[1m]))", "legendFormat": "task_requests" },
        { "refId": "B", "expr": "sum(rate(task_errors_total{service_name=\"history\"}[1m]))", "legendFormat": "task_errors" }
      ]
    },
    {
      "id": 12,
      "type": "timeseries",
      "title": "Task Processing Latency",
      "description": "Time to process history tasks.",
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 19 },
      "fieldConfig": { "defaults": { "unit": "s", "custom": { "showPoints": "never" } }, "overrides": [] },
      "options": { "legend": { "displayMode": "list", "placement": "bottom" } },
      "targets": [
        { "refId": "A", "expr": "histogram_quantile(0.95, sum by (le) (rate(task_latency_processing_bucket{service_name=\"history\"}[5m])))", "legendFormat": "processing p95" },
        { "refId": "B", "expr": "histogram_quantile(0.95, sum by (le) (rate(task_latency_queue_bucket{service_name=\"history\"}[5m])))", "legendFormat": "queue p95 (e2e)" }
      ]
    },

    { "id": 16, "type": "row", "title": "Persistence Layer", "gridPos": { "h": 1, "w": 24, "x": 0, "y": 27 }, "collapsed": false, "panels": [] },

    {
      "id": 17,
      "type": "timeseries",
      "title": "Persistence Request Rate",
      "description": "Database operations per second.",
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 28 },
      "fieldConfig": { "defaults": { "unit": "ops", "custom": { "showPoints": "never" } }, "overrides": [] },
      "options": { "legend": { "displayMode": "table", "placement": "right", "calcs": ["mean"] } },
      "targets": [{ "refId": "A", "expr": "topk(10, sum by (operation) (rate(persistence_requests_total[1m])))", "legendFormat": "{{operation}}" }]
    },
    {
      "id": 18,
      "type": "timeseries",
      "title": "Persistence Latency p95",
      "description": "95th percentile database latency by operation.",
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 28 },
      "fieldConfig": { "defaults": { "unit": "s", "custom": { "showPoints": "never" } }, "overrides": [] },
      "options": { "legend": { "displayMode": "table", "placement": "right", "calcs": ["mean", "max"] } },
      "targets": [{ "refId": "A", "expr": "topk(5, histogram_quantile(0.95, sum by (operation, le) (rate(persistence_latency_bucket[5m]))))", "legendFormat": "{{operation}}" }]
    },

    { "id": 21, "type": "row", "title": "Workflow Outcomes", "gridPos": { "h": 1, "w": 24, "x": 0, "y": 36 }, "collapsed": false, "panels": [] },

    {
      "id": 27,
      "type": "timeseries",
      "title": "Workflow Completion by Outcome",
      "description": "How workflows are completing.",
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "gridPos": { "h": 8, "w": 24, "x": 0, "y": 37 },
      "fieldConfig": { "defaults": { "unit": "ops", "custom": { "showPoints": "never" } }, "overrides": [] },
      "options": { "legend": { "displayMode": "table", "placement": "right", "calcs": ["sum"] }, "stacking": { "mode": "normal", "group": "A" } },
      "targets": [
        { "refId": "A", "expr": "sum(rate(workflow_success_total{namespace=~\"$namespace\"}[1m]))", "legendFormat": "success" },
        { "refId": "B", "expr": "sum(rate(workflow_continued_as_new_total{namespace=~\"$namespace\"}[1m]))", "legendFormat": "continued_as_new" },
        { "refId": "C", "expr": "sum(rate(workflow_failed_total{namespace=~\"$namespace\"}[1m]))", "legendFormat": "failed" },
        { "refId": "D", "expr": "sum(rate(workflow_timeout_total{namespace=~\"$namespace\"}[1m]))", "legendFormat": "timeout" },
        { "refId": "E", "expr": "sum(rate(workflow_terminate_total{namespace=~\"$namespace\"}[1m]))", "legendFormat": "terminate" },
        { "refId": "F", "expr": "sum(rate(workflow_cancel_total{namespace=~\"$namespace\"}[1m]))", "legendFormat": "cancel" }
      ]
    }
  ],

  "refresh": "30s",
  "schemaVersion": 39,
  "style": "dark",
  "tags": ["temporal", "server"],
  "templating": {
    "list": [
      {
        "name": "namespace",
        "label": "Namespace",
        "type": "query",
        "datasource": { "type": "prometheus", "uid": "prometheus" },
        "query": "label_values(service_requests_total, namespace)",
        "refresh": 2,
        "includeAll": true,
        "multi": true,
        "allValue": ".*",
        "current": { "text": "All", "value": ".*" }
      }
    ]
  },
  "time": { "from": "now-30m", "to": "now" },
  "timepicker": {
    "refresh_intervals": ["5s", "10s", "30s", "1m", "5m"],
    "time_options": ["5m", "15m", "30m", "1h", "6h"]
  },
  "timezone": "browser",
  "title": "Temporal Server Health",
  "uid": "temporal-server-health",
  "version": 1,
  "weekStart": ""
}
