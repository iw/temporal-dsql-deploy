# Docker Compose for local testing without DSQL/OpenSearch dependencies
# Uses SQLite for persistence and disables visibility for minimal testing

version: '3.8'

services:
  temporal-local-test:
    image: temporal-dsql:latest
    container_name: temporal-dsql-local-test
    ports:
      - "7233:7233"  # Frontend gRPC
      - "8233:8233"  # Frontend HTTP (if enabled)
    environment:
      - TEMPORAL_LOG_LEVEL=info
      - TEMPORAL_ENVIRONMENT=development
    volumes:
      - ./config/local-test.yaml:/etc/temporal/config/local-test.yaml:ro
      - temporal-sqlite-data:/tmp/temporal
    command: 
      - /usr/local/bin/temporal-server
      - --config-file
      - /etc/temporal/config/local-test.yaml
      - start
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:7233/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    restart: unless-stopped

  temporal-ui-local:
    image: temporalio/ui:latest
    container_name: temporal-ui-local-test
    ports:
      - "8080:8080"
    environment:
      - TEMPORAL_ADDRESS=temporal-local-test:7233
      - TEMPORAL_CORS_ORIGINS=http://localhost:3000,http://localhost:8080
    depends_on:
      temporal-local-test:
        condition: service_healthy
    restart: unless-stopped

volumes:
  temporal-sqlite-data:
    driver: local