# Dynamic configuration for Aurora DSQL development environment

# =============================================================================
# Eager Execution Settings
# =============================================================================

# Enable eager activity execution - activities can be dispatched back to the
# same worker that completed the workflow task, bypassing the server round-trip
# Required for SDK's DisableEagerActivities=false to have effect
# Default: false (must be explicitly enabled)
system.enableActivityEagerExecution:
  - value: true
    constraints: {}

# Eager workflow start is enabled by default (true)
# Allows first workflow task to be returned inline with StartWorkflowExecution response

# =============================================================================
# DSQL-Specific Settings
# =============================================================================

# Enable DSQL mode for optimistic concurrency control handling
persistence.enableDSQLMode:
  - value: true
    constraints: {}

# Advanced Visibility settings - CRITICAL for Elasticsearch integration
system.enableReadFromClosedExecutionV2:
  - value: true
    constraints: {}

system.advancedVisibilityWritingMode:
  - value: "on"
    constraints: {}

system.enableReadVisibilityFromES:
  - value: true
    constraints: {}

system.enableLogCustomerQueryParameter:
  - value: true
    constraints: {}

# DSQL optimizations - higher QPS for 512 shards
history.persistenceMaxQPS:
  - value: 6000
    constraints: {}

matching.persistenceMaxQPS:
  - value: 6000
    constraints: {}

frontend.persistenceMaxQPS:
  - value: 6000
    constraints: {}

# DSQL connection settings
persistence.maxConns:
  - value: 20
    constraints: {}

persistence.maxIdleConns:
  - value: 20
    constraints: {}

# DSQL transaction retry settings (due to optimistic concurrency control)
persistence.transactionSizeLimit:
  - value: 4000000
    constraints: {}

# Buffered events settings (for ID generation)
history.maxBufferedQueryCount:
  - value: 1000
    constraints: {}

# Task processing settings optimized for DSQL
matching.numTaskqueueReadPartitions:
  - value: 8
    constraints: {}

matching.numTaskqueueWritePartitions:
  - value: 8
    constraints: {}

# Matching service throughput settings
matching.maxTaskBatchSize:
  - value: 100
    constraints: {}

matching.getTasksBatchSize:
  - value: 1000
    constraints: {}

matching.longPollExpirationInterval:
  - value: 60s
    constraints: {}

# History service settings
history.timerProcessorMaxPollRPS:
  - value: 20
    constraints: {}

history.timerProcessorUpdateAckInterval:
  - value: 30s
    constraints: {}

# Visibility settings (if using DSQL for visibility)
visibility.maxPageSize:
  - value: 1000
    constraints: {}

# Cluster membership settings
system.membershipMaxJoinDuration:
  - value: 30s
    constraints: {}

# Archival settings
archival.history.enableRead:
  - value: true
    constraints: {}

archival.visibility.enableRead:
  - value: true
    constraints: {}

# Namespace settings
system.enableNamespaceNotActiveAutoForwarding:
  - value: true
    constraints: {}

# Worker settings
worker.enableLogging:
  - value: true
    constraints: {}

# Frontend settings
frontend.enableClientVersionCheck:
  - value: true
    constraints: {}

# Matching settings
matching.enableTaskInfoLogByDomainID:
  - value: false
    constraints: {}

# System settings
system.enableParentClosePolicy:
  - value: true
    constraints: {}

# DSQL-specific retry and timeout settings
persistence.defaultActivityRetryPolicy:
  - value:
      InitialIntervalInSeconds: 1
      MaximumIntervalInSeconds: 100
      BackoffCoefficient: 2.0
      MaximumAttempts: 0
    constraints: {}

# DSQL connection health check
persistence.healthCheckInterval:
  - value: 30s
    constraints: {}

# Nexus settings - DISABLE to avoid DSQL connection issues
system.enableNexus:
  - value: false
    constraints: {}

frontend.enableNexusAPIs:
  - value: false
    constraints: {}

worker.enableNexus:
  - value: false
    constraints: {}

# Disable Nexus endpoint registry to prevent DSQL queries
system.nexusEndpointRegistryEnabled:
  - value: false
    constraints: {}